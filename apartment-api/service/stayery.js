const response = [
  {
    arrival: '2024-11-26',
    departure: '2024-11-29',
    featured: false,
    property: {
      id: 'WOB_SW',
      name: 'Wolfsburg Schachtweg',
    },
    unitType: {
      id: 'WOB_SW-BIG',
      name: 'BIG',
      pmsDescription:
        '22 m² Apartment &nbsp&nbsp|&nbsp&nbsp1,40 m Doppelbett&nbsp&nbsp|&nbsp&nbsp1 - 2 Gäste\n\nCheck-In: &nbsp&nbsp&nbsp&nbsp 15:00\nCheck-Out: 11:00',
    },
    rates: [
      {
        id: 'WOB_SW-NR_SHORT_BIG-BIG',
        name: 'Nicht erstattbar',
        description:
          'Für Aufenthalte bis zu 6 Nächten. Die Bezahlung ist zum Zeitpunkt der Buchung fällig. Keine Rückerstattung, auch im Falle einer Stornierung.',
        availableUnits: 14,
        totalBaseAmount: {
          amount: 217,
          currency: 'EUR',
        },
        totalGrossAmount: {
          amount: 217,
          currency: 'EUR',
        },
        includedExtras: [],
        guaranteeType: 'Prepayment',
        prePaymentAmount: {
          amount: 217,
          currency: 'EUR',
        },
        cancellationPolicy: {
          name: 'Nicht erstattbarer Shortstay ',
          description:
            'Für Aufenthalte bis zu 6 Nächten. Die Bezahlung ist zum Zeitpunkt der Buchung fällig. Keine Rückerstattung, auch im Falle einer Stornierung.',
          fee: {
            amount: 217,
            currency: 'EUR',
          },
          dueDateTime: '2024-11-04T19:59:24.925Z',
        },
        taxes: [
          {
            id: 'VAT',
            type: 'VAT',
            amount: 14.2,
            currency: 'EUR',
            name: '',
          },
        ],
        isPromoRate: false,
        isCorporateRate: false,
        avgPricePerSliceWithoutExtras: {
          netAmount: 67.6,
          grossAmount: 72.33,
          currency: 'EUR',
        },
      },
      {
        id: 'WOB_SW-SHORT_BIG-BIG',
        name: 'Kostenlose Stornierung',
        description:
          'Du bist nur kurz in der Stadt? Unsere Shortstay Rate ist perfekt für Aufenthalte von bis zu 6 Nächten.',
        availableUnits: 14,
        totalBaseAmount: {
          amount: 254,
          currency: 'EUR',
        },
        totalGrossAmount: {
          amount: 254,
          currency: 'EUR',
        },
        includedExtras: [],
        guaranteeType: 'CreditCard',
        prePaymentAmount: {
          amount: 0,
          currency: 'EUR',
        },
        cancellationPolicy: {
          name: 'Flexibel Shortstay',
          description:
            'Bleib flexibel! Du kannst kostenfrei bis 18 Uhr am Anreisetag stornieren. Ansonsten entspricht die Stornierungsgebühr der Anzahl der gebuchten Nächte, beträgt jedoch maximal den Preis von den ersten 3 Übernachtungen.',
          fee: {
            amount: 248.92,
            currency: 'EUR',
          },
          dueDateTime: '2024-11-26T14:00:00.000Z',
        },
        taxes: [
          {
            id: 'VAT',
            type: 'VAT',
            amount: 16.62,
            currency: 'EUR',
            name: '',
          },
        ],
        isPromoRate: false,
        isCorporateRate: false,
        avgPricePerSliceWithoutExtras: {
          netAmount: 79.13,
          grossAmount: 84.67,
          currency: 'EUR',
        },
      },
      {
        id: 'WOB_SW-SHORT_BIG_BFST-BIG',
        name: 'Kostenlose Stornierung und Frühstücksbox',
        description:
          'Buche eine Frühstücksbox, welche Dir morgens bis 7 Uhr an Deine Apartmenttür geliefert wird. Eine Buchung ist bis 17 Uhr am Anreisetag möglich.\n\nInhalt:\n1x Vegetarisch belegtes Brötchen\n1x Süßes Gebäckstück\n1x Fruchtjoghurt \n1x Beckers Bester Direktsaft 0,33l \n1x Stück Obst ',
        availableUnits: 14,
        totalBaseAmount: {
          amount: 254,
          currency: 'EUR',
        },
        totalGrossAmount: {
          amount: 296,
          currency: 'EUR',
        },
        includedExtras: [
          {
            id: 'WOB_SW-BFST',
            name: 'Frühstücksbox',
            description:
              'Unsere Frühstücksbox wird Dir morgens bis 7 Uhr an Deine Apartmenttür geliefert. Die Box enthält ein vegetarisch belegtes Brötchen, süßes Gebäckstück, Fruchtjoghurt, Saft sowie ein Stück Obst. Kaffee und Tee stehen in Deinem Apartment bereit. \n\nDu kannst das Frühstück bis 17 Uhr am Anreisetag buchen.',
            pricingMode: 'Additional',
            totalGrossAmount: {
              amount: 42,
              currency: 'EUR',
            },
            grossAmount: {
              amount: 14,
              currency: 'EUR',
            },
            isInclusiveInRate: true,
          },
        ],
        guaranteeType: 'CreditCard',
        prePaymentAmount: {
          amount: 0,
          currency: 'EUR',
        },
        cancellationPolicy: {
          name: 'Flexibel Shortstay',
          description:
            'Bleib flexibel! Du kannst kostenfrei bis 18 Uhr am Anreisetag stornieren. Ansonsten entspricht die Stornierungsgebühr der Anzahl der gebuchten Nächte, beträgt jedoch maximal den Preis von den ersten 3 Übernachtungen.',
          fee: {
            amount: 248.92,
            currency: 'EUR',
          },
          dueDateTime: '2024-11-26T14:00:00.000Z',
        },
        taxes: [
          {
            id: 'VAT',
            type: 'VAT',
            amount: 19.36,
            currency: 'EUR',
            name: '',
          },
        ],
        isPromoRate: false,
        isCorporateRate: false,
        avgPricePerSliceWithoutExtras: {
          netAmount: 79.13,
          grossAmount: 84.67,
          currency: 'EUR',
        },
      },
    ],
    fromPrice: {
      amount: 72.33333333333333,
      currency: 'EUR',
    },
  },
  {
    arrival: '2024-11-26',
    departure: '2024-11-29',
    featured: false,
    property: {
      id: 'WOB_SW',
      name: 'Wolfsburg Schachtweg',
    },
    unitType: {
      id: 'WOB_SW-BIGGER',
      name: 'BIGGER',
      pmsDescription:
        '30 m² Apartment &nbsp&nbsp|&nbsp&nbsp1,80 m Kingsize Bett&nbsp&nbsp|&nbsp&nbsp1 - 2 Gäste\n\nCheck-In: &nbsp&nbsp&nbsp&nbsp 15:00\nCheck-Out: 11:00',
    },
    rates: [
      {
        id: 'WOB_SW-NR_SHORT_BIGGER-BIGGER',
        name: 'Nicht erstattbar',
        description:
          'Für Aufenthalte bis zu 6 Nächten. Die Bezahlung ist zum Zeitpunkt der Buchung fällig. Keine Rückerstattung, auch im Falle einer Stornierung.',
        availableUnits: 4,
        totalBaseAmount: {
          amount: 243,
          currency: 'EUR',
        },
        totalGrossAmount: {
          amount: 243,
          currency: 'EUR',
        },
        includedExtras: [],
        guaranteeType: 'Prepayment',
        prePaymentAmount: {
          amount: 243,
          currency: 'EUR',
        },
        cancellationPolicy: {
          name: 'Nicht erstattbarer Shortstay ',
          description:
            'Für Aufenthalte bis zu 6 Nächten. Die Bezahlung ist zum Zeitpunkt der Buchung fällig. Keine Rückerstattung, auch im Falle einer Stornierung.',
          fee: {
            amount: 243,
            currency: 'EUR',
          },
          dueDateTime: '2024-11-04T19:59:24.925Z',
        },
        taxes: [
          {
            id: 'VAT',
            type: 'VAT',
            amount: 15.9,
            currency: 'EUR',
            name: '',
          },
        ],
        isPromoRate: false,
        isCorporateRate: false,
        avgPricePerSliceWithoutExtras: {
          netAmount: 75.7,
          grossAmount: 81,
          currency: 'EUR',
        },
      },
      {
        id: 'WOB_SW-SHORT_BIGGER-BIGGER',
        name: 'Kostenlose Stornierung',
        description:
          'Du bist nur kurz in der Stadt? Unsere Shortstay Rate ist perfekt für Aufenthalte von bis zu 6 Nächten.',
        availableUnits: 4,
        totalBaseAmount: {
          amount: 284,
          currency: 'EUR',
        },
        totalGrossAmount: {
          amount: 284,
          currency: 'EUR',
        },
        includedExtras: [],
        guaranteeType: 'CreditCard',
        prePaymentAmount: {
          amount: 0,
          currency: 'EUR',
        },
        cancellationPolicy: {
          name: 'Flexibel Shortstay',
          description:
            'Bleib flexibel! Du kannst kostenfrei bis 18 Uhr am Anreisetag stornieren. Ansonsten entspricht die Stornierungsgebühr der Anzahl der gebuchten Nächte, beträgt jedoch maximal den Preis von den ersten 3 Übernachtungen.',
          fee: {
            amount: 278.32,
            currency: 'EUR',
          },
          dueDateTime: '2024-11-26T14:00:00.000Z',
        },
        taxes: [
          {
            id: 'VAT',
            type: 'VAT',
            amount: 18.58,
            currency: 'EUR',
            name: '',
          },
        ],
        isPromoRate: false,
        isCorporateRate: false,
        avgPricePerSliceWithoutExtras: {
          netAmount: 88.47,
          grossAmount: 94.67,
          currency: 'EUR',
        },
      },
      {
        id: 'WOB_SW-SHORT_BIGGER_BFST-BIGGER',
        name: 'Kostenlose Stornierung und Frühstücksbox',
        description:
          'Buche eine Frühstücksbox, welche Dir morgens bis 7 Uhr an Deine Apartmenttür geliefert wird. Eine Buchung ist bis 17 Uhr am Anreisetag möglich.\n\nInhalt:\n1x Vegetarisch belegtes Brötchen\n1x Süßes Gebäckstück\n1x Fruchtjoghurt \n1x Beckers Bester Direktsaft 0,33l \n1x Stück Obst ',
        availableUnits: 4,
        totalBaseAmount: {
          amount: 284,
          currency: 'EUR',
        },
        totalGrossAmount: {
          amount: 326,
          currency: 'EUR',
        },
        includedExtras: [
          {
            id: 'WOB_SW-BFST',
            name: 'Frühstücksbox',
            description:
              'Unsere Frühstücksbox wird Dir morgens bis 7 Uhr an Deine Apartmenttür geliefert. Die Box enthält ein vegetarisch belegtes Brötchen, süßes Gebäckstück, Fruchtjoghurt, Saft sowie ein Stück Obst. Kaffee und Tee stehen in Deinem Apartment bereit. \n\nDu kannst das Frühstück bis 17 Uhr am Anreisetag buchen.',
            pricingMode: 'Inclusive',
            totalGrossAmount: {
              amount: 42,
              currency: 'EUR',
            },
            grossAmount: {
              amount: 14,
              currency: 'EUR',
            },
            isInclusiveInRate: true,
          },
        ],
        guaranteeType: 'CreditCard',
        prePaymentAmount: {
          amount: 0,
          currency: 'EUR',
        },
        cancellationPolicy: {
          name: 'Flexibel Shortstay',
          description:
            'Bleib flexibel! Du kannst kostenfrei bis 18 Uhr am Anreisetag stornieren. Ansonsten entspricht die Stornierungsgebühr der Anzahl der gebuchten Nächte, beträgt jedoch maximal den Preis von den ersten 3 Übernachtungen.',
          fee: {
            amount: 278.32,
            currency: 'EUR',
          },
          dueDateTime: '2024-11-26T14:00:00.000Z',
        },
        taxes: [
          {
            id: 'VAT',
            type: 'VAT',
            amount: 21.33,
            currency: 'EUR',
            name: '',
          },
        ],
        isPromoRate: false,
        isCorporateRate: false,
        avgPricePerSliceWithoutExtras: {
          netAmount: 88.47,
          grossAmount: 94.67,
          currency: 'EUR',
        },
      },
    ],
    fromPrice: {
      amount: 81,
      currency: 'EUR',
    },
  },
];

export async function getStayeryQuote(from, to) {
  from = from.toISOString().substr(0, 10);
  to = to.toISOString().substr(0, 10);

  const requestUrl = `https://ibe-server.uphotel.agency/api/ibe/availability?propertyId=WOB_SW&arrival=${from}&departure=${to}&adults=1`;
  console.log(requestUrl);

  const response = await fetch(
    'https://ibe-server.uphotel.agency/api/ibe/availability?propertyId=WOB_SW&arrival=2024-11-26&departure=2024-11-29&adults=1',
    {
      headers: {
        accept: 'application/json, text/plain, */*',
        'accept-language': 'de',
        'ibe-key': '48e3b63d-a415-41ec-9566-a56a4571c2f4',
        'ibe-language': 'de',
        'ibe-version': '1e6f486a3e947ebb4b5954aaa08e54038f5682da',
        'if-none-match': 'W/"1fb8-k5dfHwfcnnETGniWzsV+k95kwQY"',
        priority: 'u=1, i',
        'sec-ch-ua': '"Chromium";v="131", "Not_A Brand";v="24"',
        'sec-ch-ua-mobile': '?0',
        'sec-ch-ua-platform': '"macOS"',
        'sec-fetch-dest': 'empty',
        'sec-fetch-mode': 'cors',
        'sec-fetch-site': 'cross-site',
        'x-journey-token': 'iwkYEOtfl0nmBnNiak7dcDku72R4sJHpCZKw',
        Referer: 'https://www.stayery.com/',
        'Referrer-Policy': 'strict-origin-when-cross-origin',
      },
      body: null,
      method: 'GET',
    }
  );
  const data = await response.json();
  console.log('response', response);
  // find the cheapest offer and calculate the price per day
  const cheapestOffer = data.reduce(
    (cheapest, offer) => {
      if (offer.fromPrice.amount < cheapest.price) {
        return {
          price: offer.fromPrice.amount,
          cancellationPolicy: offer.rates[0].cancellationPolicy.name,
        };
      }
      return cheapest;
    },
    { price: Infinity }
  );

  const cheapestPrice = cheapestOffer.price;
  const days = (new Date(to) - new Date(from)) / (1000 * 60 * 60 * 24);
  const pricePerDay = cheapestPrice / days;

  return {
    days,
    cheapestPrice,
    pricePerDay,
  };
}
